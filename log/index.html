<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Mateus de Lima Oliveira's log</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/css/foundation.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/motion-ui/1.2.3/motion-ui.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/css/foundation-prototype.min.css">
    <link href='https://cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.css' rel='stylesheet' type='text/css'>
    <!-- optional CDN for Foundation Icons ^^ -->

    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  </head>
  <body>

    <!-- logo and ad break -->
    <br>

    <article class="grid-container">
      <div class="grid-x grid-margin-x">
        <div class="medium-4 cell">
          <img src="../ativarsoft.png" alt="Ativarsoft">
        </div>
        <div class="medium-8 cell">
          <img src="https://placehold.it/900x175&text=Advertisement" alt="advertisement">
        </div>
      </div>
    </article>
    <!-- / logo and ad break -->
    
    <br>

    <article class="grid-container">

      <div class="grid-x grid-margin-x">
        <div class="large-4 cell">
          <h1>Oliveira's log</h1>
          <p>
            I am Mateus de Lima Oliveira (the owner of Ativarsoft) and this is my blog page.
          </p>
          <p>
            Maybe I will drop some opinions of mine here...
          </p>
          <ul>
            <li><a href="2021-09.xml">September 2021</a></li>
            <li><a href="2022-07.xml">July 2022</a></li>
            <li><a href="2022-08.xml">August 2022</a></li>
          </ul>
        </div>

        <div class="large-8 cell">
          <div class="grid-x grid-margin-x">
            <div class="large-2 cell">
              <p><img src="https://upload.wikimedia.org/wikipedia/commons/4/4c/Detail_of_mugwort_mature_leaf.jpg" alt="Mugwort photo"></p>
            </div>
            <div class="large-6 cell">
              <h2>Nutrition</h2>
              <p>
                <a href="https://www.verywellhealth.com/fruit-and-vegetable-allergies-symptoms-and-diagnosis-1323908">
                  Mugwort allergies
                </a>
                are associated with sensitivities to peach, lychee, mango, grape, celery, carrot, parsley, fennel,
                garlic, cabbage, broccoli, coriander, cumin, sunflower seeds, and peanuts.
              </p>
            </div>
          </div>
          <div class="grid-x grid-margin-x">
            <div class="large-2 cell">
              <p><img src="https://raw.githubusercontent.com/rust-lang/rust-artwork/master/logo/rust-logo-blk.svg" alt="Rust programming language logo"></p>
            </div>
            <div class="large-6 cell">
              <h2>Rust programming language</h2>
              <p>
                The <a href="https://doc.rust-lang.org/reference/linkage.html">staticlib</a> linkage type in Rust
                produces static library binaries that include the runtime and all the dependencies.
                According to the manual, "the purpose of this output type is to create a static library containing
                all of the local crate's code along with all upstream dependencies".
              </p>
            </div>
          </div>
        </div>
      </article>

      <article class="grid-container">

        <div class="grid-x grid-margin-x grid-margin-y">
          <div class="cell">
            <h1>Pollen: creating a secure portable assembler</h1>
            <h3>Mateus de Lima Oliveira</h3>
          </div>
        </div>

        <div class="grid-x grid-margin-x grid-margin-y">
          <div class="cell">
            <p>
              Pollen is a programming language that I'm creating and will be relased soon.
              It is similar to Templatizer on the syntax and modularity.
            </p>
          </div>
        </div>
        
        <div class="grid-x grid-margin-x grid-margin-y">
          <div class="cell">
            <h2>About this book</h2>
            <p>
              This book is about Pollen programming language - a modern programming language designed to be a <strong>safe portable assembler</strong>.
              The C language was created to be a simple language that works like
              an assembly language that is portable between different machine architectures and operating systems.
              Pollen tryies to be like C in the aspect of being portable and having constructs that can be easily and intuitively
              mapped to machine instructions and data.
            </p>
          </div>
        </div>

        <div class="grid-x grid-margin-x grid-margin-y">
          <div class="cell">
            <h2>Introduction</h2>
            <p>
              <b>Pollen</b> is based on a previous programming language written by myself that was codenamed <i>Templatizer</i>.
              Templatizer was designed to be a web template language.
              It didn't gain much attention because there are many web template languages out there
              and "templatizer" was already a generic name for many web template languages out there on the internet.
            </p>
            <p>
              Currently, there is only an interpreter for Pollen, but other code generation libraries will be supported soon.
              Multiple code generation libraries are intended to be supported by using an abstraction layer for them.
              This creates a slight and most of the times negligible performance penality, but makes the language
              portable across different platforms and operating systems, including embedded systems.
            </p>
          </div>
        </div>

        <div class="grid-x grid-margin-x">
          <div class="cell">
            <h2>Operating system development in modern languages and static libraries</h2>
            <p>
              It is difficult, in my opinion, to write C programs that include multiple static libraries in them in modern programming languages.
              Modern programming languages usually include a runtime library. Rust, D and Ada all include a runtime.
            </p>
            <p>
              The Rust runtime is very minimal but it is required because it includes definitions for basic integer types, vectors and others. The <code>no_std</code> macro leaves only operating system independent code that do not depend on allocations.
            </p>
            <p>
              That is analogous to <a href="https://dlang.org/spec/betterc.html">betterC</a> in D. betterC removes the runtime library entirely. There is no GC, TypeInfo, or allocations.
            </p>
            <ul>
              <li>
                Rust does not require runtime initialization when Rust libraries are linked statically.
              </li>
              <li>
                Ada requires a runtime initialization by calling <a href="https://gcc.gnu.org/onlinedocs/gcc-3.4.6/gnat_ugn_unw/Binding-with-Non_002dAda-Main-Programs.html">adainit and adafinal</a>.
              </li>
              <li>
                D also requires runtime initialization when not in <a href="https://dlang.org/spec/betterc.html">betterC</a> mode for initializing the GC and other globals as well as calling some operating system functions for setting state such as pthreads.
              </li>
            </ul>
            <p>
              In previous versions, <code>cargo init</code> created libraries by default instead of binaries.
              Those modules contained Rust-only code which were linked to static or dynamic libraries written in C, including the C standard library or any operating system library.
              Similarly, Ada libraries contain only Ada code.
              In fact, <code>.a</code> libraries can be linked just like <code>.o</code> object files, which in turn map to a source file written in a specific language.
            </p>
            <h2>Coding style</h2>
            <p>
              The major source of securities is <b>pointers</b>.
            </p>
            <ul>
              <li>Without pointers, there is no null dereference.</li>
              <li>Without pointers, there is no pointer arithmetic.</li>
              <li>Without pointer arithmetic, there is no array out of bounds.</li>
            </ul>
            <p>
              Traditionally, C source is divided into <code>.c</code> and <code>.h</code>.
              The C source contain no pointes. The header files contain macros that use pointers.
            </p>
            <p>
              Headers can be used to define <code>typedef</code>s for the <code>.c</code> files to use.
              Similarly to variable declarations, the new identifier is on the right hand side of the typedef.
              The following declares a pointer to a my_struct record as my_struct_t.
              Traditionally, <code>_t</code> means "type" and is used to defferentiate
              the type identifiers from variable and parameter identifiers.
            </p>
            <pre><code class="language-c">/* typedef <existing_name> <alias_name>; */
struct my_struct {
    int my_field;
};

typedef struct my_struct *my_struct_t;
            </code></pre>
            <p>Or simply...</p>
            <pre><code class="language-c">typedef struct my_struct {
    int my_field;
} *my_struct_t;
            </code></pre>
            <h2>Virtual address spaces</h2>
            <p>
              <a href="https://en.m.wikipedia.org/wiki/Virtual_address_space">
                Virtual addressing
              </a>
              can be used in addition to safe programming languages.
              That allows the developer to include legacy code written in older programming languages.
            </p>
            <p>
              Only the root user can run programs which will run as a different user (except for setuid).
              Daemons can fork its process in order to have a process running under an unprivileged user in order to insulate each API request from each other.
            </p>
            <p>
              Therefore the only major concern is the part of the programs that parse the request input (such as JSON or XML) which contain the authentication data of the request and the socket connection itself.
              The part of the server that deals with such type of data should be handled by a carefully verified framework written in a secure language, and the parts which contain code written in an older programming language should be in worker processes which are forked or executed.
            </p>

            <h2>Development roadmap</h2>
            <p>
              The following is my future development:
            </p>
            <ol>
              <li>Convert Quick to a series daemons</li>
              <li>Remove autotools from Quick</li>
              <li>Merge Quick with Templatizer</li>
            </ol>

            <h2>JIT</h2>
            <ul>
              <li>GNU libjit (<a href="https://packages.debian.org/bullseye/libgccjit-10-dev">libgccjit-10-dev</a>)</li>
              <li>LLVM bytecode</li>
            </ul>
            <p>
              <a href="https://llvm.org/docs/tutorial/">Kaleidoscope</a> is an example of a JIT language that uses the LLVM code generation.
            </p>

            <h3>LLVM code generation</h3>
            <p>
              <code>llvm-config</code> is similar to <code>pkg-config</code>
              but it is specific to LLVM code generation. llvm-config must be
              found in <code>$PATH</code> for it to work. It is expected to be
              only one llvm toolchain associated with that <code>llvm-config</code>.
              That toolchain is responsible for code generation and may have
              different architectures as targets.
            </p>

            <p>
              Steps for producing bitcode with llvm-dev:
            </p>

<pre><code class="language-make">LLVM_CFLAGS=$(shell llvm-config --cflags)
LLVM_LDFLAGS=$(shell llvm-config --ldflags --libs)
</code></pre>

            <ol>
              <li>Create a new Pollen plug-in</li>
              <li>Add CFLAGS and LDFLAGS llvm-config</li>
              <li>Create module;</li>
              <li>Add code;</li>
              <li>Add basic blocks;</li>
              <li>Append basic block to program in memory;</li>
              <li>Write bitcode to object file or BC file on HDD or SSD.</li>
            </ol>

            <h2>External links</h2>
            <ul>
              <li><a href="https://dlang.org/">D Programming Language</a></li>
              <li><a href="https://www.rust-lang.org/">Rust Programming Language</a></li>
            </ul>
          </div>
        </div>
      </div>
    </article>
    
    <footer>
      <div class="grid-x grid-margin-y expanded">
        <div class="medium-6 cell">
          <ul class="menu">
            <li><a href="https://ativarsoft.com">Start page</a></li>
            <li><a href="https://ativarsoft.com/log/index.html">Blog</a></li>
            <li><a href="https://github.com/ativarsoft/">GitHub</a></li>
          </ul>
        </div>

        <div class="medium-6 cell">
          <ul class="menu align-right">
            <li class="menu-text">Copyright © 2023 Mateus de Lima Oliveira</li>
          </ul>
        </div>
      </div>
    </footer>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/js/foundation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/motion-ui/1.2.3/motion-ui.min.js"></script>
    <script>
      $(document).foundation();
    </script>
    <script>hljs.highlightAll();</script>
  </body>
</html>
